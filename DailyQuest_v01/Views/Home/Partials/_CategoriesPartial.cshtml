@model DailyQuest_v01.Models.ViewModels.CategoriesViewModels

<div class="page-breadcrumb">
    <div class="row">
        <div class="col-12 d-flex no-block align-items-center">
            <div class="pt-2 pb-2">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0" style="background-color: transparent; font-size: 1.1rem;">
                        <li class="breadcrumb-item">
                            <a asp-controller="Home" asp-action="SocialIndex"
                               class="text-secondary text-decoration-none">
                                社交論壇管理
                            </a>
                        </li>
                        <li class="breadcrumb-item active text-dark fw-semibold" aria-current="page">
                            類別管理
                        </li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">論壇文章貼文類別</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.PostCategories.First().CategoryId)</th>
                        <th>@Html.DisplayNameFor(model => model.PostCategories.First().CategoryName)</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody class="customtable">
                    @foreach (var item in Model.PostCategories)
                    {
                        <tr id="row-@item.CategoryId">
                            <td>@item.CategoryId</td>
                            <td>@item.CategoryName</td>
                            <td>
                                <a href="#" class="btn btn-outline-info load-edit-post-category" id="@item.CategoryId">編輯</a>
                                <button class="btn-delete-post btn btn-outline-danger" data-id="@item.CategoryId">刪除</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <a href="#" class="btn btn-outline-success load-create-post-category">新增類別</a>
        </div>
    </div>
</div>
<div class="card">
    <div class="card-body">
        <h5 class="card-title">可檢舉類別</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().ReportCategoryId)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().ReportCategoryName)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().Description)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().CreatedAt)</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody class="customtable">
                    @foreach (var item in Model.ReportCategories)
                    {
                        <tr id="row-@item.ReportCategoryId">
                            <td>@item.ReportCategoryId</td>
                            <td>@item.ReportCategoryName</td>
                            <td>@item.Description</td>
                            <td>@item.CreatedAt</td>
                            <td>
                                <a href="#" class="btn btn-outline-info load-edit-report-category" id="@item.ReportCategoryId">編輯</a>
                                <button class="btn-delete-report btn btn-outline-danger" data-id="@item.ReportCategoryId">刪除</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#createReportCategoryModal">新增類別</button>
        </div>
    </div>
</div>
<!-- Modal 彈出視窗 -->
<div class="modal fade" id="createReportCategoryModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">新增檢舉類別</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createReportCategoryForm">
                    <div class="mb-3">
                        <label for="reportCategoryName" class="form-label">類別名稱</label>
                        <input type="text" class="form-control" id="reportCategoryName" name="reportCategoryName" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">說明</label>
                        <input type="text" class="form-control" id="description" name="description">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="cancel-createReportCategories btn btn-secondary">取消</button>
                <button type="button" class="btn btn-primary" id="submitCreateReportCategory">送出</button>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).on('click', '.btn-delete-post', function () {
    const id = $(this).data('id');
         if (!confirm("你確定要刪除這個分類嗎？")) return;

        $.ajax({
                url: "https://localhost:7131/API/DeletePostCategory/"+id,
            type: 'DELETE',
            success: function (data) {
                if (data.success) {
                    $(`#row-${id}`).remove();
                    alert("貼文類別刪除成功！編號為 "+id);
                } else {
                    alert(data.message || "刪除失敗");
                }
            },
            
        });
    });

    $(document).on('click', '.btn-delete-report', function () {
        const id = $(this).data('id');
             if (!confirm("你確定要刪除這個檢舉項目嗎？")) return;
            $.ajax({
                        url: "https://localhost:7131/API/DeleteReportCategory/"+id,
                type: 'DELETE',
                success: function (data) {
                    if (data.success) {
                        $(`#row-${id}`).remove();
                        alert("檢舉類別項目刪除成功！編號為 "+id);
                    } else {
                        alert(data.message || "刪除失敗");
                    }
                },
                
            });
        });

    $(document).on('click', '.load-create-post-category', function (e) {
           e.preventDefault();

           $.get('@Url.Action("CreatePostCategory", "Home")', function (result) {
                // 隱藏原本的整頁內容
                $('#page-body-container').hide();

                // 僅做右側內容更新
                $('#content-area').html(result).fadeIn();
             });
          });

    $(document).on('click', '.load-edit-post-category', function (e) {
           e.preventDefault();
           const id = $(this).attr('id');

           $.get('@Url.Action("EditPostCategory", "Home")'+'/'+id, function (result) {
                // 隱藏原本的整頁內容
                $('#page-body-container').hide();

                // 僅做右側內容更新
                $('#content-area').html(result).fadeIn();
           });
    });

     $(document).on('click', '.load-edit-report-category', function (e) {
          e.preventDefault();
         const id = $(this).attr('id');

         $.get('@Url.Action("EditReportCategory", "Home")' + '/' + id, function (result) {
             // 隱藏原本的整頁內容
             $('#page-body-container').hide();

             // 僅做右側內容更新
             $('#content-area').html(result).fadeIn();
         });
     });

    $('#submitCreateReportCategory').on('click', function () {
      const data = {
        reportCategoryName: $('#reportCategoryName').val(),
        description: $('#description').val()
      };

      $.ajax({
        url: '/Home/CreateReportCategory',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function (res) {
          if (res.success) {
            alert(res.message);
            $('#createReportCategoryModal').modal('hide');
            $('#reportCategoryName').val('');
            $('#description').val('');
            loadCategoriesPartial();
          } 
          else {
            alert("新增失敗：" + res.message);
          }
        },
     });
   });

    $(document).on('click', '.cancel-createReportCategories', function (e) {
      e.preventDefault();
      $('#createReportCategoryModal').modal('hide');
    });
</script>

