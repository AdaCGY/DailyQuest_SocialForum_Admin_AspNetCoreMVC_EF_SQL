@model DailyQuest_v01.Models.ViewModels.CategoriesViewModels
@{
    Layout = "~/Views/Shared/SocialLayout.cshtml";
}

<div class="page-breadcrumb">
    <div class="row">
        <div class="col-12 d-flex no-block align-items-center">
            <h2 class="pb-2">類別管理</h2>
            <div class="ms-auto text-end">
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">論壇文章貼文類別</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.PostCategories.First().CategoryId)</th>
                        <th>@Html.DisplayNameFor(model => model.PostCategories.First().CategoryName)</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody class="customtable">
                    @foreach (var item in Model.PostCategories)
                    {
                        <tr id="row-@item.CategoryId">
                            <td>@item.CategoryId</td>
                            <td>@item.CategoryName</td>
                            <td>
                                <a asp-controller="Home" asp-action="EditPostCategory" asp-route-id="@item.CategoryId" class="btn btn-outline-info">編輯</a>
                                <button class="btn-delete-post btn btn-outline-danger" data-id="@item.CategoryId">刪除</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <a type="button" class="btn btn-outline-success" asp-controller="Home" asp-action="CreatePostCategory">新增類別</a>
        </div>
    </div>
</div>
<div class="card">
    <div class="card-body">
        <h5 class="card-title">可檢舉類別</h5>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().ReportCategoryId)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().ReportCategoryName)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().Description)</th>
                        <th>@Html.DisplayNameFor(model => model.ReportCategories.First().CreatedAt)</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody class="customtable">
                    @foreach (var item in Model.ReportCategories)
                    {
                        <tr id="row-@item.ReportCategoryId">
                            <td>@item.ReportCategoryId</td>
                            <td>@item.ReportCategoryName</td>
                            <td>@item.Description</td>
                            <td>@item.CreatedAt</td>
                            <td>
                                <a asp-action="EditReportCategory" asp-route-id="@item.ReportCategoryId" class="btn btn-outline-info">編輯</a>
                                <button class="btn-delete-report btn btn-outline-danger" data-id="@item.ReportCategoryId">刪除</button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <a type="button" class="btn btn-outline-success" asp-controller="Home" asp-action="CreateReportCategory">新增類別</a>
        </div>
    </div>
</div>

@section Scripts {
<script>
    $(document).on('click', '.btn-delete-post', function () {
    const id = $(this).data('id');
        $.ajax({
                url: "https://localhost:7131/API/DeletePostCategory/"+id,
            type: 'DELETE',
            success: function (data) {
                if (data.success) {
                    if (!confirm("你確定要刪除這個分類嗎？")) return;
                    $(`#row-${id}`).remove();
                    alert("貼文類別刪除成功！編號為 "+id);
                } else {
                    alert(data.message || "刪除失敗");
                }
            },
            error: function (err) {
                console.error("錯誤：", err);
                alert("發生錯誤！");
            }
        });
    });

    $(document).on('click', '.btn-delete-report', function () {
        const id = $(this).data('id');
            $.ajax({
                        url: "https://localhost:7131/API/DeleteReportCategory/"+id,
                type: 'DELETE',
                success: function (data) {
                    if (data.success) {
                        if (!confirm("你確定要刪除這個檢舉項目嗎？")) return;
                        $(`#row-${id}`).remove();
                        alert("檢舉類別項目刪除成功！編號為 "+id);
                    } else {
                        alert(data.message || "刪除失敗");
                    }
                },
                error: function (err) {
                    console.error("錯誤：", err);
                    alert("發生錯誤！");
                }
            });
        });
</script>
}
